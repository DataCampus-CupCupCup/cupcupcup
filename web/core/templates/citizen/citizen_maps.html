{% extends 'layouts/base.html' %}

{% block title %} Maps {% endblock title %}

{% block content %}

    <!-- Header -->
    <div class="header bg-gradient-primary pb-8 pt-6 md-8">
      <div class="container-fluid">
        <div class="row">
            <div class="col-xl-6 input-group mb-3">
              <div class="input-group-prepend">
                <span class="input-group-text" id="addon-wrapping"><i class="fas fa-search"></i></span>
              </div>
              <input type="text" class="form-control" placeholder="지역구명을 적어주세요. 예) 부산진구" aria-label="Recipient's username" aria-describedby="button-addon2" aria-describedby="addon-wrapping">
              <div class="input-group-append">
                <button class="btn btn-primary" type="button" id="button-addon2">내 지역구 검색</button>
              </div>
            </div>
            <div class="ml-2">
                <button class="btn btn-secondary">현재 수거함만 보기</button>
                <button class="btn btn-slack">예상 수거함만 보기</button>
            </div>
          <div class="col-12">
            <div class="card shadow border-0 mt-3">
              <div id="map" class="map-canvas" style="height: 600px;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid mt--7">
      <div class="header-body">
        <!-- Card stats -->
        <div class="row">
          <div class="col-xl-3 col-lg-6">
            <div class="card card-stats mb-4 mb-xl-0">
              <div class="card-body">
                <div class="row">
                  <div class="col">
                    <h5 class="card-title text-uppercase text-muted mb-0">우리구 수거함 갯수</h5>
                    <span class="h2 font-weight-bold mb-0">{{count}}</span>
                  </div>
                  <div class="col-auto">
                    <div class="icon icon-shape bg-danger text-white rounded-circle shadow">
                      <i class="fas fa-trash-alt"></i>
                    </div>
                  </div>
                </div>
                <p class="mt-3 mb-0 text-muted text-sm">
                  <span class="text-danger mr-2"><i class="fas fa-arrow-down"></i> 50개</span>
                  <span class="text-nowrap">다른 구 평균 보다</span>
                </p>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-lg-6">
            <div class="card card-stats mb-4 mb-xl-0">
              <div class="card-body">
                <div class="row">
                  <div class="col">
                    <h5 class="card-title text-uppercase text-muted mb-0">예상 설치 지역</h5>
                    <span class="h2 font-weight-bold mb-0">50</span>
                  </div>
                  <div class="col-auto">
                    <div class="icon icon-shape bg-success text-white rounded-circle shadow">
                      <i class="fas fa-recycle"></i>
                    </div>
                  </div>
                </div>
                <p class="mt-3 mb-0 text-muted text-sm">
                  <span class="text-danger mr-2"><i class="fas fa-arrow-up"></i> 40 개 지역</span>
                  <span class="text-nowrap">다른 구 평균 보다</span>
                </p>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-lg-6">
            <div class="card card-stats mb-4 mb-xl-0">
              <div class="card-body">
                
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-lg-6">
            <div class="card card-stats mb-4 mb-xl-0">
              <div class="card-body">
              </div>
            </div>
          </div>
        </div>
      </div>

      {% include "includes/footer.html" %}

    </div>

{% endblock content %}

<!-- Specific JS goes HERE --> 
{% block javascripts %}
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=47cebf243fb31acc12d9459c8feb0493"></script>
<script type="text/javascript">
  var pc = JSON.parse('{{pc|safe}}');
  // var pc = JSON.parse('{{pc|safe}}');
  console.log(pc);
  var pcPositions = []
  for(var i in pc){
    var c = pc[i]["fields"];
    var point = {
      title:  pc[i]["pk"],
      latlng : new kakao.maps.LatLng(c["lat"],c["long"])
      };
    pcPositions.push(point)
  };

  var mapContainer = document.getElementById('map'), // 지도를 표시할 div  
      mapOption = { 
          center: new kakao.maps.LatLng(pc[0]["fields"]["lat"], pc[0]["fields"]["long"]), // 지도의 중심좌표
          level: 3 // 지도의 확대 레벨
      };

  var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

  // 마커 이미지의 이미지 주소입니다
  var imageSrc = "/static/assets/img/map/map_marker.png";

  for (var i = 0; i < pcPositions.length; i ++) {
      
      // 마커 이미지의 이미지 크기 입니다
      var imageSize = new kakao.maps.Size(45, 61); 
      
      // 마커 이미지를 생성합니다    
      var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize); 
      
      // 마커를 생성합니다
      var marker = new kakao.maps.Marker({
          map: map, // 마커를 표시할 지도
          position: pcPositions[i].latlng, // 마커를 표시할 위치
          title : pcPositions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
          image : markerImage // 마커 이미지 
      });
  }
</script>

{% endblock javascripts %}
